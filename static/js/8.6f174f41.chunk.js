(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{104:function(e,n,t){"use strict";var i=t(22),o=t(12),r=t(25),a=t(23),s=t(24),l=t(115),c=t(116),u=t.n(c),f=t(88),d=t(118),p=t.n(d),h=function(){function e(n){var t=this;Object(i.a)(this,e),this._polifill(function(){t.fileStream=p.a.createWriteStream(t.name,{size:t.size}),t.writer=t.fileStream.getWriter()}),this.size=n.size,this.name=n.name,this.create=!0,this.lastAppendTime=new Date,this.received=0}return Object(o.a)(e,[{key:"append",value:function(e,n){var t=this;this._polifill(function(){var i=new Blob([e]).stream().getReader();!function o(){return i.read().then(function(i){if(i.done){var r=t._calculateSpeed(e.byteLength),a=t._calculateProgress(e.byteLength);n(r,a)}else t.writer.write(i.value).then(o)})}()})}},{key:"close",value:function(){this.writer&&(this.writer.close(),this.writer=null)}},{key:"abort",value:function(){this.writer&&(this.fileStream.abort(),this.writer.abort())}},{key:"_calculateProgress",value:function(e){return this.received+=e,100*this.received/this.size}},{key:"_calculateSpeed",value:function(e){var n=new Date,t=n.getTime()-this.lastAppendTime.getTime();return this.lastAppendTime=n,1e3*e/t}},{key:"_polifill",value:function(e){if(window.WebStreamsPolyfill)e();else{Object.defineProperty(Blob.prototype,"stream",{configurable:!0,enumerable:!0,writable:!0,value:function(){return new Response(this).body}});var n=document.createElement("script");n.setAttribute("src","https://cdn.jsdelivr.net/npm/web-streams-polyfill@2.0.2/dist/ponyfill.min.js"),n.async=!0,n.onreadystatechange=n.onload=function(){e.done||n.readyState&&!/loaded|complete/.test(n.readyState)||(e.done=!0,e())},document.getElementsByTagName("head")[0].appendChild(n)}}}]),e}();t.d(n,"a",function(){return m});var m=function(e){function n(){var e;return Object(i.a)(this,n),(e=Object(r.a)(this,Object(a.a)(n).call(this))).CHUNK_SIZE=512e3,e.peer=null,e.pairs={},e.outgoing=[],e._initializePeer(),e}return Object(s.a)(n,e),Object(o.a)(n,[{key:"abortFiles",value:function(){var e=!0,n=!1,t=void 0;try{for(var i,o=this.pairs.values()[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var r=i.value,a=!0,s=!1,l=void 0;try{for(var c,u=r.incoming[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var f=c.value;f.file&&f.abort()}}catch(d){s=!0,l=d}finally{try{a||null==u.return||u.return()}finally{if(s)throw l}}}}catch(d){n=!0,t=d}finally{try{e||null==o.return||o.return()}finally{if(n)throw t}}}},{key:"requestFileInfos",value:function(e){return this._ensureConnection(e,function(e){var n={type:f.a.Request_File_Infos};e.send(n)}),f.b.Info_Got}},{key:"downloadFile",value:function(e,n){var t=this.pairs[e].incoming.find(function(e){return e.name===n.name});Object.assign(t,{file:new h({name:t.name,size:t.size})}),this._requestFileChunk(e,n,0)}},{key:"setOutgingFiles",value:function(e){var n=this;if(e)for(var t=function(t){var i=e.item(t);n.outgoing.findIndex(function(e){return e.name==i.name})<0&&n.outgoing.push(i)},i=0;i<e.length;i++)t(i)}},{key:"_initializePeer",value:function(){this.peer=new u.a(null,{debug:3,confi:{iceServers:[{url:"stun:stun.services.mozilla.com"},{url:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]}}),this.peer.on("open",this._peerOpen.bind(this)),this.peer.on("connection",this._peerConnection.bind(this)),this.peer.on("disconnected",this._peerDisconnected.bind(this)),this.peer.on("close",this._peerClose.bind(this)),this.peer.on("error",this._peerError.bind(this))}},{key:"_peerOpen",value:function(e){this.emit(f.b.Peer_Opened,e)}},{key:"_peerConnection",value:function(e){var n=this.pairs[e.peer];n&&n.conn&&n.conn.open||(this.pairs[e.peer]={conn:e},console.log("_peerConnection "+e.open),this._initializeConnection(e))}},{key:"_peerDisconnected",value:function(){}},{key:"_peerClose",value:function(){}},{key:"_peerError",value:function(e){console.error("Peer error "+e.type),console.error(e)}},{key:"_ensureConnection",value:function(e,n){var t=this.pairs[e];if(t||(this.pairs[e]={},t=this.pairs[e]),!t.conn||!t.conn.open)return t.conn=this.peer.connect(e),console.log("this.peer.connect"+t.conn.open),void this._initializeConnection(t.conn,n);n&&n(t.conn)}},{key:"_initializeConnection",value:function(e,n){var t=this;e.on("open",function(){console.log("conn opened"),n&&n(e)}),e.on("data",function(n){t._onJSONData(n,e)}),e.on("error",function(n){t._connError(n,e)}),e.on("close",function(){t._connClose(e)})}},{key:"_connError",value:function(e,n){console.error(e)}},{key:"_connClose",value:function(e){console.error("conn closed")}},{key:"_onJSONData",value:function(e,n){switch(e.type){case f.a.Request_File_Infos:var t={type:f.a.Response_File_INfos,payload:Array.from(this.outgoing,function(e){return{name:e.name,size:e.size,type:e.type,peer:this.id}},this.peer)};n.send(t);break;case f.a.Response_File_INfos:var i=this.pairs[n.peer];if(i.incoming){var o=!0,r=!1,a=void 0;try{for(var s,l=function(){var e=s.value;i.incoming.find(function(n){return n.name===e.name})||i.incoming.push(e)},c=e.payload[Symbol.iterator]();!(o=(s=c.next()).done);o=!0)l()}catch(u){r=!0,a=u}finally{try{o||null==c.return||c.return()}finally{if(r)throw a}}}else i.incoming=e.payload;this.emit(f.b.Info_Got,n.peer,e.payload);break;case f.a.Request_File_Chunk:this._sendFileChunk(e.payload,n);break;case f.a.Response_File_Chunk:this._receiveFileChunk(e.payload,n);break;default:console.error("Unknown message: "+e)}}},{key:"_requestFileChunk",value:function(e,n,t){this._ensureConnection(e,function(e){var i={type:f.a.Request_File_Chunk,payload:{fileInfo:{name:n.name},index:t}};e.send(i)})}},{key:"_receiveFileChunk",value:function(e,n){var t=this,i=e.index,o=e.fileInfo,r=e.data,a=e.last,s=this.pairs[n.peer].incoming.find(function(e){return e.name===o.name});s.file.append(r,function(e,r){a?(s.file.close(),t.emit(f.b.File_Got,s)):(t.emit(f.b.File_Progress,s,e,r),t._requestFileChunk(n.peer,o,i+1))})}},{key:"_sendFileChunk",value:function(e,n){var t=new FileReader,i=e.fileInfo,o=e.index,r=this.outgoing.find(function(e){return e.name===i.name}),a=!1,s=o*this.CHUNK_SIZE,l=s+this.CHUNK_SIZE;l>=r.size&&(l=r.size,a=!0);var c=(r.slice||r.mozSlice||r.webkitSlice).call(r,s,l);t.onload=function(e){if(t.readyState===FileReader.DONE){var r=e.target.result,s={type:f.a.Response_File_Chunk,payload:{index:o,fileInfo:i,data:r,last:a}};n.send(s)}},t.readAsArrayBuffer(c)}}]),n}(l.EventEmitter)},117:function(e,n){function t(e){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=117},181:function(e,n,t){"use strict";t.r(n);var i=t(22),o=t(12),r=t(25),a=t(23),s=t(24),l=t(0),c=t.n(l),u=t(175),f=t(79),d=t(174),p=t(182),h=t(183),m=t(184),v=t(185),y=t(186),_=t(137),b=t(11),g=t(142),k=t.n(g),F=t(143),w=t.n(F),C=t(104),I=t(88),O=function(e){function n(e){var t;return Object(i.a)(this,n),(t=Object(r.a)(this,Object(a.a)(n).call(this,e))).remoteId=e.match.params.id,t.myPeer=null,t.state={peerFiles:[]},t}return Object(s.a)(n,e),Object(o.a)(n,[{key:"componentWillMount",value:function(){this.myPeer=new C.a,this.initializeMyPeer()}},{key:"componentWillUnmount",value:function(){this.myPeer.abortFiles()}},{key:"initializeMyPeer",value:function(){var e=this;this.myPeer.on(I.b.Peer_Opened,function(e){console.log(e)}),this.myPeer.on(I.b.Info_Got,function(n,t){console.log(t),e.setState({peerFiles:t})}),this.myPeer.on(I.b.File_Progress,function(e,n,t){console.log("Speed: ".concat(n,"; Progress: ").concat(t))}),this.myPeer.on(I.b.File_Got,function(n){e.state.peerFiles.find(function(e){return e.name===n.name}).downloading=!1,e.setState({}),console.log("finished")})}},{key:"retriveFileInfos",value:function(e){this.myPeer.requestFileInfos(this.remoteId)}},{key:"downloadFile",value:function(e,n){console.log(n),n.downloading=!0,this.setState({}),this.myPeer.downloadFile(this.remoteId,n)}},{key:"render",value:function(){var e=this.props.classes;return c.a.createElement("div",null,c.a.createElement(u.a,{variant:"contained",component:"span",className:e.button,color:"primary",onClick:this.retriveFileInfos.bind(this)},"Retrive Files"),this.state.peerFiles&&this.state.peerFiles.length&&this.renderFileInfos())}},{key:"renderFileInfos",value:function(){var e=this,n=this.props.classes;return c.a.createElement("div",null,c.a.createElement(f.a,{variant:"h6",className:n.title},this.remoteId),c.a.createElement("div",{className:n.paperBackground},c.a.createElement(d.a,{dense:!0},this.state.peerFiles.map(function(n){return c.a.createElement(p.a,{key:n.name},c.a.createElement(h.a,null,c.a.createElement(m.a,null,c.a.createElement(k.a,null))),c.a.createElement(v.a,{primary:n.name,secondary:n.size}),c.a.createElement(y.a,null,c.a.createElement(_.a,{edge:"end","aria-label":"Download",disabled:!!n.downloading,onClick:function(t){e.downloadFile(t,n)}},c.a.createElement(w.a,null))))}))))}}]),n}(c.a.Component);n.default=Object(b.a)(function(e){return{button:{margin:e.spacing(1)},buttonInput:{display:"none"},title:{margin:e.spacing(4,0,2)},paperBackground:{backgroundColor:e.palette.background.paper}}},{withTheme:!0})(O)},88:function(e,n,t){"use strict";t.d(n,"a",function(){return o}),t.d(n,"b",function(){return r});var i=t(22),o=function e(){Object(i.a)(this,e)};o.Request_File_Infos="request_file_infos",o.Response_File_INfos="response_file_infos",o.Request_File_Chunk="request_download_file_chunk",o.Response_File_Chunk="response_download_file_chunk";var r=function e(){Object(i.a)(this,e)};r.Peer_Opened="peer_opened",r.Info_Got="info_got",r.File_Got="file_got",r.File_Progress="file_progress"}}]);
//# sourceMappingURL=8.6f174f41.chunk.js.map