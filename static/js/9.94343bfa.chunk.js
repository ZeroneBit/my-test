(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{104:function(e,n,t){"use strict";var i=t(22),o=t(12),r=t(25),s=t(23),a=t(24),l=t(115),c=t(116),u=t.n(c),f=t(88),h=t(118),p=t.n(h),d=function(){function e(n){Object(i.a)(this,e),this.size=n.size,this.name=n.name,this.create=!0,this.fileStream=p.a.createWriteStream(this.name,{size:this.size}),this.writer=this.fileStream.getWriter()}return Object(o.a)(e,[{key:"append",value:function(e){console.log(e.length),this.writer.write(e)}},{key:"close",value:function(){this.writer.close()}},{key:"_reset",value:function(){}}]),e}();t.d(n,"a",function(){return _});var _=function(e){function n(){var e;return Object(i.a)(this,n),(e=Object(r.a)(this,Object(s.a)(n).call(this))).CHUNK_SIZE=16777216,e.peer=null,e.pairs={},e.outgoing=[],e._initializePeer(),e}return Object(a.a)(n,e),Object(o.a)(n,[{key:"requestFileInfos",value:function(e){return this._ensureConnection(e,function(e){console.log("sending request "+e.open);var n={type:f.a.Request_File_Infos};e.send(n)}),f.b.Info_Got}},{key:"downloadFile",value:function(e,n){var t=this.pairs[e].incoming.find(function(e){return e.name===n.name});Object.assign(t,{file:new d({name:t.name,size:t.size})}),this._requestFileChunk(e,n,0)}},{key:"setOutgingFiles",value:function(e){var n=this;if(e)for(var t=function(t){var i=e.item(t);n.outgoing.findIndex(function(e){return e.name==i.name})<0&&n.outgoing.push(i)},i=0;i<e.length;i++)t(i)}},{key:"_initializePeer",value:function(){this.peer=new u.a(null,{debug:3,confi:{iceServers:[{url:"stun:stun.services.mozilla.com"},{url:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]}}),this.peer.on("open",this._peerOpen.bind(this)),this.peer.on("connection",this._peerConnection.bind(this)),this.peer.on("disconnected",this._peerDisconnected.bind(this)),this.peer.on("close",this._peerClose.bind(this)),this.peer.on("error",this._peerError.bind(this))}},{key:"_peerOpen",value:function(e){this.emit(f.b.Peer_Opened,e)}},{key:"_peerConnection",value:function(e){var n=this.pairs[e.peer];n&&n.conn&&n.conn.open||(this.pairs[e.peer]={conn:e},console.log("_peerConnection "+e.open),this._initializeConnection(e))}},{key:"_peerDisconnected",value:function(){}},{key:"_peerClose",value:function(){}},{key:"_peerError",value:function(e){console.error("Peer error "+e.type),console.error(e)}},{key:"_ensureConnection",value:function(e,n){var t=this.pairs[e];if(t||(this.pairs[e]={},t=this.pairs[e]),!t.conn||!t.conn.open)return t.conn=this.peer.connect(e),console.log("this.peer.connect"+t.conn.open),void this._initializeConnection(t.conn,n);n&&n(t.conn)}},{key:"_initializeConnection",value:function(e,n){var t=this;e.on("open",function(){console.log("conn opened"),n&&n(e)}),e.on("data",function(n){void 0!==n.byteLength||t._onJSONData(n,e)}),e.on("error",function(n){t._connError(n,e)}),e.on("close",function(){t._connClose(e)})}},{key:"_connError",value:function(e,n){console.error(e)}},{key:"_connClose",value:function(e){console.error("conn closed")}},{key:"_onJSONData",value:function(e,n){switch(e.type){case f.a.Request_File_Infos:var t={type:f.a.Response_File_INfos,payload:Array.from(this.outgoing,function(e){return{name:e.name,size:e.size,type:e.type,peer:this.id}},this.peer)};n.send(t);break;case f.a.Response_File_INfos:this.pairs[n.peer].incoming=e.payload,this.emit(f.b.Info_Got,n.peer,e.payload);break;case f.a.Request_File_Chunk:this._sendFileChunk(e.payload,n);break;case f.a.Response_File_Chunk:this._receiveFileChunk(e.payload,n);break;default:console.error("Unknown message: "+e)}}},{key:"_requestFileChunk",value:function(e,n,t){this._ensureConnection(e,function(e){console.log("download file "+e.open);var i={type:f.a.Request_File_Chunk,payload:{fileInfo:{name:n.name},index:t}};e.send(i)})}},{key:"_receiveFileChunk",value:function(e,n){var t=e.index,i=e.fileInfo,o=e.data,r=e.last,s=this.pairs[n.peer].incoming.find(function(e){return e.name===i.name});s.file.append(o),r?(s.file.close(),this.emit(f.b.File_Got,i)):(this.emit(f.b.File_Progress,i,t*this.CHUNK_SIZE),this._requestFileChunk(n.peer,i,t+1))}},{key:"_sendFileChunk",value:function(e,n){var t=new FileReader,i=e.fileInfo,o=e.index,r=this.outgoing.find(function(e){return e.name===i.name}),s=!1,a=o*this.CHUNK_SIZE,l=a+this.CHUNK_SIZE;l>=r.size&&(l=r.size,s=!0);var c=(r.slice||r.mozSlice||r.webkitSlice).call(r,a,l);t.onload=function(e){if(t.readyState===FileReader.DONE){var r=e.target.result,a={type:f.a.Response_File_Chunk,payload:{index:o,fileInfo:i,data:r,last:s}};n.send(a)}},t.readAsArrayBuffer(c)}}]),n}(l.EventEmitter)},117:function(e,n){function t(e){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=117},180:function(e,n,t){"use strict";t.r(n);var i=t(22),o=t(12),r=t(25),s=t(23),a=t(24),l=t(0),c=t.n(l),u=t(175),f=t(188),h=t(11),p=t(104),d=t(88),_=function(e){function n(e){var t;return Object(i.a)(this,n),(t=Object(r.a)(this,Object(s.a)(n).call(this,e))).textFieldRef=c.a.createRef(),t.state={progress:0,receiverUrl:"",outgoing:[]},t.myPeer=null,t}return Object(a.a)(n,e),Object(o.a)(n,[{key:"componentWillMount",value:function(){this.myPeer=new p.a,this.initializeMyPeer()}},{key:"initializeMyPeer",value:function(){var e=this;this.myPeer.on(d.b.Peer_Opened,function(n){console.log(n),e.setState({receiverUrl:"".concat(window.location,"/").concat(n)})})}},{key:"selectFile",value:function(e){var n=e.target.files;this.myPeer.setOutgingFiles(n),this.setState({outgoing:this.myPeer.outgoing})}},{key:"oCopy",value:function(e){this.textFieldRef&&this.textFieldRef.value&&(this.textFieldRef.select(),document.execCommand("Copy"),this.setState({snackbarOpen:!0}))}},{key:"render",value:function(){var e=this,n=this.props.classes;return c.a.createElement("div",null,c.a.createElement("input",{id:"button-file",className:n.buttonInput,type:"file",multiple:!0,onChange:this.selectFile.bind(this)}),c.a.createElement("label",{htmlFor:"button-file"},c.a.createElement(u.a,{variant:"contained",component:"span",className:n.button,color:"primary"},"Select Files")),this.state.outgoing&&this.state.outgoing.map(function(e){return c.a.createElement("div",null,e.name)}),c.a.createElement(f.a,{label:"Receiver Url",placeholder:"Receiver Url",variant:"outlined",margin:"normal",fullWidth:!0,value:this.state.receiverUrl,inputRef:function(n){e.textFieldRef=n}}),c.a.createElement(u.a,{variant:"contained",component:"span",className:n.button,color:"primary",disabled:!this.state.receiverUrl,onClick:this.oCopy.bind(this)},"Copy Receiver Url"))}}]),n}(c.a.Component);n.default=Object(h.a)(function(e){return{button:{margin:e.spacing(1)},buttonInput:{display:"none"}}},{withTheme:!0})(_)},88:function(e,n,t){"use strict";t.d(n,"a",function(){return o}),t.d(n,"b",function(){return r});var i=t(22),o=function e(){Object(i.a)(this,e)};o.Request_File_Infos="request_file_infos",o.Response_File_INfos="response_file_infos",o.Request_File_Chunk="request_download_file_chunk",o.Response_File_Chunk="response_download_file_chunk";var r=function e(){Object(i.a)(this,e)};r.Peer_Opened="peer_opened",r.Info_Got="info_got",r.File_Got="file_got",r.File_Progress="file_progress"}}]);
//# sourceMappingURL=9.94343bfa.chunk.js.map