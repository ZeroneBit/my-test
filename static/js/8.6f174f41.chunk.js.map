{"version":3,"sources":["services/MyFile.js","services/MyPeer.js","../node_modules/peerjs/dist sync","components/MyFileReceiver.js","services/MyEnums.js"],"names":["MyFile","options","_this","this","Object","classCallCheck","_polifill","fileStream","streamSaver","createWriteStream","name","size","writer","getWriter","create","lastAppendTime","Date","received","data","done","_this2","reader","Blob","stream","getReader","pump","read","then","res","speed","_calculateSpeed","byteLength","progress","_calculateProgress","write","value","close","abort","time","milliseconds","getTime","callback","window","WebStreamsPolyfill","defineProperty","prototype","configurable","enumerable","writable","Response","body","js","document","createElement","setAttribute","async","onreadystatechange","onload","readyState","test","getElementsByTagName","appendChild","MyPeer","possibleConstructorReturn","getPrototypeOf","call","CHUNK_SIZE","peer","pairs","outgoing","_initializePeer","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","values","Symbol","iterator","next","pair","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","incoming","ic","file","err","return","remoteId","_ensureConnection","conn","message","type","EventTypes","Request_File_Infos","send","PeerEvents","Info_Got","fileInfo","inc","find","f","assign","_requestFileChunk","files","_loop","i","item","findIndex","o","push","length","Peer","debug","confi","iceServers","url","credential","username","on","_peerOpen","bind","_peerConnection","_peerDisconnected","_peerClose","_peerError","id","emit","Peer_Opened","open","console","log","_initializeConnection","error","connect","openCallback","_this3","_onJSONData","_connError","_connClose","Response_File_INfos","payload","Array","from","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_loop2","_iterator3","Request_File_Chunk","_sendFileChunk","Response_File_Chunk","_receiveFileChunk","chunkIndex","index","_this4","last","iFile","append","File_Got","File_Progress","FileReader","blob","isLastChunk","start","end","slicedBlob","slice","mozSlice","webkitSlice","event","DONE","blockBuffer","target","result","readAsArrayBuffer","EventEmitter","webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports","MyFileReceiver","props","D_Test_my_test_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","D_Test_my_test_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_2__","D_Test_my_test_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_3__","match","params","myPeer","state","peerFiles","initializeMyPeer","abortFiles","selfId","peerId","setState","concat","downloading","requestFileInfos","downloadFile","classes","react__WEBPACK_IMPORTED_MODULE_5___default","a","_material_ui_core__WEBPACK_IMPORTED_MODULE_6__","variant","component","className","button","color","onClick","retriveFileInfos","renderFileInfos","_material_ui_core__WEBPACK_IMPORTED_MODULE_7__","title","paperBackground","_material_ui_core__WEBPACK_IMPORTED_MODULE_8__","dense","map","_material_ui_core__WEBPACK_IMPORTED_MODULE_9__","key","_material_ui_core__WEBPACK_IMPORTED_MODULE_10__","_material_ui_core__WEBPACK_IMPORTED_MODULE_11__","_material_ui_icons_Folder__WEBPACK_IMPORTED_MODULE_16___default","_material_ui_core__WEBPACK_IMPORTED_MODULE_12__","primary","secondary","_material_ui_core__WEBPACK_IMPORTED_MODULE_13__","_material_ui_core__WEBPACK_IMPORTED_MODULE_14__","edge","aria-label","disabled","_material_ui_icons_CloudDownload__WEBPACK_IMPORTED_MODULE_17___default","React","Component","withStyles","theme","margin","spacing","buttonInput","display","backgroundColor","palette","background","paper","withTheme"],"mappings":"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","file":"static/js/8.6f174f41.chunk.js","sourcesContent":["import streamSaver from 'streamsaver';\r\n\r\nexport default class MyFile {\r\n    constructor(options) {\r\n\r\n        this._polifill(() => {\r\n            this.fileStream = streamSaver.createWriteStream(\r\n                this.name,\r\n                { size: this.size, }\r\n            );\r\n            this.writer = this.fileStream.getWriter();\r\n        });\r\n\r\n        this.size = options.size;\r\n        this.name = options.name;\r\n\r\n        this.create = true;\r\n\r\n        this.lastAppendTime = new Date();\r\n        this.received = 0;\r\n    }\r\n\r\n    append(data, done) {\r\n        this._polifill(() => {\r\n            const blob = new Blob([data]);\r\n            const readableStream = blob.stream();\r\n            const reader = readableStream.getReader();\r\n            const pump = () => reader.read()\r\n                .then(res => {\r\n                    if (res.done) {\r\n                        let speed = this._calculateSpeed(data.byteLength);\r\n                        let progress = this._calculateProgress(data.byteLength);\r\n                        done(speed, progress);\r\n                    } else {\r\n                        this.writer.write(res.value).then(pump);\r\n                    }\r\n                });\r\n\r\n            pump();\r\n        });\r\n    }\r\n\r\n    close() {\r\n        if (this.writer) {\r\n            this.writer.close();\r\n            this.writer = null;\r\n        }\r\n    }\r\n\r\n    abort() {\r\n        if (this.writer) {\r\n            this.fileStream.abort();\r\n            this.writer.abort();\r\n        }\r\n    }\r\n\r\n    _calculateProgress(byteLength) {\r\n        this.received += byteLength;\r\n        let progress = 100 * this.received / this.size;\r\n\r\n        return progress;\r\n    }\r\n\r\n    _calculateSpeed(byteLength) {\r\n        let time = new Date();\r\n        let milliseconds = time.getTime() - this.lastAppendTime.getTime();\r\n\r\n        this.lastAppendTime = time;\r\n\r\n        let speed = 1000 * byteLength / milliseconds;\r\n\r\n        return speed;\r\n    }\r\n\r\n    _polifill(callback) {\r\n        if (window.WebStreamsPolyfill) {\r\n            callback();\r\n        } else {\r\n            Object.defineProperty(Blob.prototype, 'stream', {\r\n                configurable: true,\r\n                enumerable: true,\r\n                writable: true,\r\n                value: function stream() {\r\n                    return new Response(this).body;\r\n                }\r\n            });\r\n\r\n            let js = document.createElement('script');\r\n            js.setAttribute('src', 'https://cdn.jsdelivr.net/npm/web-streams-polyfill@2.0.2/dist/ponyfill.min.js');\r\n            js.async = true;\r\n            js.onreadystatechange = js.onload = () => {\r\n                if (!callback.done && (!js.readyState || /loaded|complete/.test(js.readyState))) {\r\n                    callback.done = true;\r\n                    callback();\r\n                }\r\n            };\r\n            document.getElementsByTagName('head')[0].appendChild(js);\r\n        }\r\n    }\r\n}","import { EventEmitter } from 'eventemitter3';\r\nimport Peer from 'peerjs';\r\n\r\nimport { EventTypes, PeerEvents } from './MyEnums';\r\nimport MyFile from './MyFile';\r\n\r\nexport default class MyPeer extends EventEmitter {\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this.CHUNK_SIZE = 500 * 1024;\r\n\r\n        this.peer = null;\r\n        this.pairs = {};\r\n        this.outgoing = [];\r\n\r\n        this._initializePeer();\r\n    }\r\n\r\n    //publics\r\n\r\n    abortFiles() {\r\n        for (let pair of this.pairs.values()) {\r\n            for (let ic of pair.incoming) {\r\n                if (ic.file) {\r\n                    ic.abort();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    requestFileInfos(remoteId) {\r\n        this._ensureConnection(remoteId, (conn) => {\r\n            const message = {\r\n                type: EventTypes.Request_File_Infos,\r\n            };\r\n            conn.send(message);\r\n        });\r\n\r\n        return PeerEvents.Info_Got;\r\n    }\r\n\r\n    downloadFile(remoteId, fileInfo) {\r\n        let inc = this.pairs[remoteId].incoming.find(f => f.name === fileInfo.name);\r\n        Object.assign(inc, {\r\n            file: new MyFile({ name: inc.name, size: inc.size }),\r\n        });\r\n\r\n        this._requestFileChunk(remoteId, fileInfo, 0);\r\n    }\r\n\r\n    setOutgingFiles(files) {\r\n        if (files) {\r\n            for (let i = 0; i < files.length; i++) {\r\n                let f = files.item(i);\r\n                if (this.outgoing.findIndex(o => o.name == f.name) < 0) {\r\n                    this.outgoing.push(f);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    //privates\r\n    _initializePeer() {\r\n        this.peer = new Peer(null, {\r\n            debug: 3,\r\n            confi: {\r\n                'iceServers': [\r\n                    { url: 'stun:stun.services.mozilla.com' },\r\n                    { url: 'turn:numb.viagenie.ca', credential: 'muazkh', username: 'webrtc@live.com' }\r\n                ],\r\n            },\r\n        });\r\n\r\n        this.peer.on('open', this._peerOpen.bind(this));\r\n        this.peer.on('connection', this._peerConnection.bind(this));\r\n        this.peer.on('disconnected', this._peerDisconnected.bind(this));\r\n        this.peer.on('close', this._peerClose.bind(this));\r\n        this.peer.on('error', this._peerError.bind(this));\r\n    }\r\n    _peerOpen(id) {\r\n        this.emit(PeerEvents.Peer_Opened, id);\r\n    }\r\n    _peerConnection(conn) {\r\n        let pair = this.pairs[conn.peer];\r\n        if (!pair || !pair.conn || !pair.conn.open) {\r\n            this.pairs[conn.peer] = { conn };\r\n            console.log(\"_peerConnection \" + conn.open);\r\n            this._initializeConnection(conn);\r\n        }\r\n    }\r\n    _peerDisconnected() { }\r\n    _peerClose() { }\r\n    _peerError(err) {\r\n        console.error(\"Peer error \" + err.type);\r\n        console.error(err);\r\n    }\r\n\r\n    _ensureConnection(remoteId, callback) {\r\n        let pair = this.pairs[remoteId];\r\n        if (!pair) {\r\n            this.pairs[remoteId] = {};\r\n            pair = this.pairs[remoteId];\r\n        }\r\n        if (!pair.conn || !pair.conn.open) {\r\n            pair.conn = this.peer.connect(remoteId)\r\n            console.log(\"this.peer.connect\" + pair.conn.open);\r\n            this._initializeConnection(pair.conn, callback);\r\n            return;\r\n        }\r\n\r\n        callback && callback(pair.conn);\r\n    }\r\n    _initializeConnection(conn, openCallback) {\r\n        conn.on('open', () => {\r\n            console.log(\"conn opened\");\r\n            openCallback && openCallback(conn);\r\n        });\r\n        conn.on('data', (data) => {\r\n            this._onJSONData(data, conn);\r\n        });\r\n        conn.on('error', (err) => { this._connError(err, conn); });\r\n        conn.on('close', () => { this._connClose(conn); });\r\n    }\r\n\r\n    _connError(err, conn) {\r\n        console.error(err);\r\n    }\r\n    _connClose(conn) {\r\n        console.error(\"conn closed\");\r\n    }\r\n\r\n    _onJSONData(data, conn) {\r\n        switch (data.type) {\r\n            case EventTypes.Request_File_Infos: {\r\n                const message = {\r\n                    type: EventTypes.Response_File_INfos,\r\n                    payload: Array.from(this.outgoing, function (f) { return { name: f.name, size: f.size, type: f.type, peer: this.id }; }, this.peer),\r\n                };\r\n                conn.send(message);\r\n            } break;\r\n            case EventTypes.Response_File_INfos: {\r\n                let pair = this.pairs[conn.peer];\r\n                if (pair.incoming) {\r\n                    for (let f of data.payload) {\r\n                        let inc = pair.incoming.find(i => i.name === f.name);\r\n                        if (!inc) {\r\n                            pair.incoming.push(f);\r\n                        }\r\n                    }\r\n                } else {\r\n                    pair.incoming = data.payload;\r\n                }\r\n\r\n                this.emit(PeerEvents.Info_Got, conn.peer, data.payload);\r\n            } break;\r\n\r\n            case EventTypes.Request_File_Chunk: {\r\n                this._sendFileChunk(data.payload, conn);\r\n            } break;\r\n            case EventTypes.Response_File_Chunk: {\r\n                this._receiveFileChunk(data.payload, conn);\r\n            } break;\r\n            default: console.error('Unknown message: ' + data);\r\n        }\r\n    }\r\n\r\n    _requestFileChunk(remoteId, fileInfo, chunkIndex) {\r\n        this._ensureConnection(remoteId, (conn) => {\r\n            const message = {\r\n                type: EventTypes.Request_File_Chunk,\r\n                payload: {\r\n                    fileInfo: {\r\n                        name: fileInfo.name,\r\n                    },\r\n                    index: chunkIndex\r\n                },\r\n            };\r\n            conn.send(message);\r\n        });\r\n    }\r\n\r\n    _receiveFileChunk(payload, conn) {\r\n        let { index, fileInfo, data, last } = payload;\r\n        let iFile = this.pairs[conn.peer].incoming.find(f => f.name === fileInfo.name);\r\n        iFile.file.append(data, (speed, progress) => {\r\n            if (last) {\r\n                iFile.file.close();\r\n                this.emit(PeerEvents.File_Got, iFile);\r\n            }\r\n            else {\r\n                this.emit(PeerEvents.File_Progress, iFile, speed, progress);\r\n\r\n                this._requestFileChunk(conn.peer, fileInfo, index + 1);\r\n            }\r\n        });\r\n    }\r\n\r\n    _sendFileChunk(payload, conn) {\r\n        const reader = new FileReader();\r\n\r\n        let fileInfo = payload.fileInfo;\r\n        let index = payload.index;\r\n        let blob = this.outgoing.find(f => f.name === fileInfo.name);\r\n        let isLastChunk = false;\r\n        let start = index * this.CHUNK_SIZE;\r\n        let end = start + this.CHUNK_SIZE;\r\n        if (end >= blob.size) {\r\n            end = blob.size;\r\n            isLastChunk = true;\r\n        }\r\n        let slice = blob.slice || blob.mozSlice || blob.webkitSlice;\r\n        let slicedBlob = slice.call(blob, start, end);\r\n\r\n        reader.onload = function (event) {\r\n            if (reader.readyState !== FileReader.DONE) {\r\n                return;\r\n            }\r\n            const blockBuffer = event.target.result;\r\n            const message = {\r\n                type: EventTypes.Response_File_Chunk,\r\n                payload: {\r\n                    index: index,\r\n                    fileInfo: fileInfo,\r\n                    data: blockBuffer,\r\n                    last: isLastChunk,\r\n                },\r\n            };\r\n            conn.send(message);\r\n        }\r\n        reader.readAsArrayBuffer(slicedBlob);\r\n    }\r\n\r\n}","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 117;","import React from 'react';\r\nimport { Button, LinearProgress, TextField, Typography, List, ListItem, ListItemAvatar, Avatar, ListItemText, ListItemSecondaryAction, IconButton } from '@material-ui/core';\r\nimport { withStyles } from '@material-ui/core/styles';\r\nimport SvgIcon from '@material-ui/core/SvgIcon';\r\nimport Folder from '@material-ui/icons/Folder';\r\nimport Download from '@material-ui/icons/CloudDownload';\r\nimport MyPeer from '../services/MyPeer';\r\nimport { PeerEvents } from '../services/MyEnums';\r\n\r\nclass MyFileReceiver extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.remoteId = props.match.params.id;\r\n\r\n        this.myPeer = null;\r\n        this.state = {\r\n            peerFiles: []\r\n        };\r\n    }\r\n\r\n    componentWillMount() {\r\n        this.myPeer = new MyPeer();\r\n        this.initializeMyPeer();\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.myPeer.abortFiles();\r\n    }\r\n\r\n    initializeMyPeer() {\r\n        this.myPeer.on(PeerEvents.Peer_Opened, (selfId) => {\r\n            console.log(selfId);\r\n        });\r\n        this.myPeer.on(PeerEvents.Info_Got, (peerId, files) => {\r\n            console.log(files);\r\n            this.setState({ peerFiles: files });\r\n        });\r\n        this.myPeer.on(PeerEvents.File_Progress, (fileInfo, speed, progress) => {\r\n            console.log(`Speed: ${speed}; Progress: ${progress}`);\r\n        });\r\n        this.myPeer.on(PeerEvents.File_Got, (fileInfo) => {\r\n            let f = this.state.peerFiles.find(f => f.name === fileInfo.name);\r\n            f.downloading = false;\r\n            this.setState({});\r\n            console.log(\"finished\");\r\n        });\r\n    }\r\n\r\n    retriveFileInfos(event) {\r\n        this.myPeer.requestFileInfos(this.remoteId);\r\n    }\r\n\r\n    downloadFile(event, fileInfo) {\r\n        console.log(fileInfo);\r\n        fileInfo.downloading = true;\r\n        this.setState({});\r\n        this.myPeer.downloadFile(this.remoteId, fileInfo);\r\n    }\r\n\r\n    render() {\r\n\r\n        const { classes } = this.props;\r\n\r\n        return (\r\n            <div>\r\n                <Button variant=\"contained\" component=\"span\" className={classes.button}\r\n                    color=\"primary\" onClick={this.retriveFileInfos.bind(this)}>\r\n                    Retrive Files\r\n                </Button>\r\n                {\r\n                    this.state.peerFiles && this.state.peerFiles.length &&\r\n                    this.renderFileInfos()\r\n                }\r\n\r\n            </div>\r\n        );\r\n    }\r\n\r\n    renderFileInfos() {\r\n        const { classes } = this.props;\r\n\r\n        return (\r\n            <div>\r\n                <Typography variant=\"h6\" className={classes.title}>\r\n                    {this.remoteId}\r\n                </Typography>\r\n                <div className={classes.paperBackground}>\r\n                    <List dense={true} >\r\n                        {\r\n                            this.state.peerFiles.map((f) => {\r\n                                return (\r\n                                    <ListItem key={f.name}>\r\n                                        <ListItemAvatar>\r\n                                            <Avatar>\r\n                                                <Folder></Folder>\r\n                                            </Avatar>\r\n                                        </ListItemAvatar>\r\n                                        <ListItemText primary={f.name} secondary={f.size}>\r\n                                        </ListItemText>\r\n                                        <ListItemSecondaryAction>\r\n                                            <IconButton edge=\"end\" aria-label=\"Download\"\r\n                                                disabled={!!f.downloading}\r\n                                                onClick={(event) => { this.downloadFile(event, f) }}>\r\n                                                <Download></Download>\r\n                                            </IconButton>\r\n                                        </ListItemSecondaryAction>\r\n                                    </ListItem>)\r\n                            })\r\n                        }\r\n                    </List>\r\n                </div>\r\n            </div>);\r\n    }\r\n}\r\n\r\nconst styles = theme => ({\r\n    button: {\r\n        margin: theme.spacing(1),\r\n    },\r\n\r\n    buttonInput: {\r\n        display: 'none',\r\n    },\r\n\r\n    title: {\r\n        margin: theme.spacing(4, 0, 2),\r\n    },\r\n\r\n    paperBackground: {\r\n        backgroundColor: theme.palette.background.paper,\r\n    },\r\n});\r\n\r\nexport default withStyles(styles, { withTheme: true })(MyFileReceiver);","export class EventTypes {\r\n    static Request_File_Infos = 'request_file_infos';\r\n    static Response_File_INfos = 'response_file_infos';\r\n    static Request_File_Chunk = 'request_download_file_chunk';\r\n    static Response_File_Chunk = 'response_download_file_chunk';\r\n};\r\n\r\nexport class PeerEvents {\r\n    static Peer_Opened = 'peer_opened';\r\n    static Info_Got = 'info_got';\r\n    static File_Got = 'file_got';\r\n    static File_Progress = 'file_progress';\r\n}\r\n"],"sourceRoot":""}